
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Upload Diagnostic Tool</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .upload-area { border: 2px dashed #ccc; padding: 40px; text-align: center; margin: 20px 0; }
        .upload-area.dragover { border-color: #007bff; background-color: #f8f9fa; }
        .result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .file-info { text-align: left; margin: 10px 0; font-family: monospace; background: #f8f9fa; padding: 10px; border-radius: 4px; }
        .step { margin: 10px 0; padding: 10px; border-left: 4px solid #007bff; background: #f8f9fa; }
    </style>
</head>
<body>
    <h1>üîç Image Upload Diagnostic Tool</h1>
    <p>This tool helps identify why images might not be uploading correctly in Product Management.</p>
    
    <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
        <p>Click here or drag and drop an image file to test (JPG/PNG only)</p>
        <input type="file" id="fileInput" accept=".jpg,.jpeg,.png" style="display: none;" onchange="analyzeFile(this.files[0])">
    </div>
    
    <div id="results"></div>
    
    <script>
        const uploadArea = document.getElementById('uploadArea');
        const resultsDiv = document.getElementById('results');
        
        // Drag and drop functionality
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                analyzeFile(files[0]);
            }
        });
        
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = message;
            resultsDiv.appendChild(div);
        }
        
        function clearResults() {
            resultsDiv.innerHTML = '';
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function analyzeFile(file) {
            clearResults();
            
            if (!file) {
                addResult('‚ùå No file selected', 'error');
                return;
            }
            
            addResult('<h3>üìã FILE ANALYSIS RESULTS</h3>', 'info');
            
            // Display file information
            const fileInfo = `
                <div class="file-info">
                    <strong>File Details:</strong><br>
                    üìÅ Name: ${file.name}<br>
                    üìä Size: ${formatFileSize(file.size)} (${file.size} bytes)<br>
                    üéØ Type: ${file.type}<br>
                    üìÖ Last Modified: ${new Date(file.lastModified).toLocaleString()}
                </div>
            `;
            addResult(fileInfo, 'info');
            
            // Step 1: File Type Validation
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];
            if (allowedTypes.includes(file.type)) {
                addResult('‚úÖ STEP 1: File type is supported (' + file.type + ')', 'success');
            } else {
                addResult('‚ùå STEP 1: Unsupported file type (' + file.type + '). Supported types: JPG, PNG only', 'error');
                return;
            }
            
            // Step 2: File Size Validation
            const maxSize = 5 * 1024 * 1024; // 5MB
            if (file.size <= maxSize) {
                if (file.size < 1024) { // Less than 1KB
                    addResult('‚ö†Ô∏è STEP 2: File is very small (' + formatFileSize(file.size) + '). This might indicate a corrupted or empty file.', 'warning');
                } else if (file.size > 2 * 1024 * 1024) { // Larger than 2MB
                    addResult('‚ö†Ô∏è STEP 2: File is large (' + formatFileSize(file.size) + '). Consider compressing for faster uploads.', 'warning');
                } else {
                    addResult('‚úÖ STEP 2: File size is optimal (' + formatFileSize(file.size) + ')', 'success');
                }
            } else {
                addResult('‚ùå STEP 2: File too large (' + formatFileSize(file.size) + '). Maximum allowed: 5MB', 'error');
                return;
            }
            
            // Step 3: Image Validation
            const img = new Image();
            img.onload = function() {
                addResult(`‚úÖ STEP 3: Image loaded successfully (${this.width}x${this.height} pixels)`, 'success');
                
                if (this.width < 100 || this.height < 100) {
                    addResult('‚ö†Ô∏è Image is very small, which might affect display quality', 'warning');
                }
                
                if (this.width > 4000 || this.height > 4000) {
                    addResult('‚ö†Ô∏è Image is very large, consider resizing for web use', 'warning');
                }
                
                // Step 4: Attempt to test upload (simulation)
                testUploadCompatibility(file);
            };
            
            img.onerror = function() {
                addResult('‚ùå STEP 3: Invalid or corrupted image file', 'error');
            };
            
            const reader = new FileReader();
            reader.onload = function(e) {
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function testUploadCompatibility(file) {
            addResult('<div class="step">üîÑ STEP 4: Testing upload compatibility...</div>', 'info');
            
            // Test FormData compatibility
            try {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('type', 'product-image');
                addResult('‚úÖ FormData creation successful', 'success');
            } catch (error) {
                addResult('‚ùå FormData creation failed: ' + error.message, 'error');
                return;
            }
            
            // Test FileReader compatibility
            const reader = new FileReader();
            reader.onload = function() {
                addResult('‚úÖ File reading successful', 'success');
                showRecommendations(file);
            };
            reader.onerror = function() {
                addResult('‚ùå File reading failed', 'error');
            };
            reader.readAsArrayBuffer(file);
        }
        
        function showRecommendations(file) {
            addResult('<h3>üí° RECOMMENDATIONS</h3>', 'info');
            
            if (file.size > 2 * 1024 * 1024) {
                addResult('üîß Consider compressing your image using tools like TinyPNG or ImageOptim', 'warning');
            }
            
            if (file.type === 'image/gif') {
                addResult('üîß GIF files can be large. Consider using PNG or JPEG for static images', 'warning');
            }
            
            if (file.name.length > 100) {
                addResult('üîß Very long filename detected. Consider shortening the filename', 'warning');
            }
            
            addResult('‚úÖ This file should upload successfully in Product Management!', 'success');
            
            addResult(`
                <div class="step">
                    <h4>üöÄ NEXT STEPS:</h4>
                    <ol>
                        <li>Make sure you're logged in as an Admin user</li>
                        <li>Navigate to Product Management</li>
                        <li>Click "Add Product" or edit an existing product</li>
                        <li>Use the image upload slots to upload this file</li>
                        <li>Check browser console (F12) for any error messages</li>
                        <li>Verify the image appears in the preview</li>
                    </ol>
                </div>
            `, 'info');
        }
        
        // Show system information
        addResult(`
            <div class="file-info">
                <strong>üñ•Ô∏è System Information:</strong><br>
                Browser: ${navigator.userAgent}<br>
                Supports File API: ${window.File ? 'Yes' : 'No'}<br>
                Supports FormData: ${window.FormData ? 'Yes' : 'No'}<br>
                JavaScript Enabled: Yes
            </div>
        `, 'info');
    </script>
</body>
</html>
